# Disclaimer
_______

Данный репозиторий представляет собой учебный проект для выполнения домашних заданий 
по курсу [System Design - 14 поток](https://balun.courses/courses/system_design).


# Радость путешествий
_______

Все любят путешествовать, открывать новые места и делиться позитивными эмоциями. 
Что как не новая социальная сеть для путешественников поможет найти единомышленников и сделать наш мир немного счастливей!  
Давайте спроектируем сервис, который поможет всем любителям путешествий стать немного ближе друг к другу и тем местам, что им нравятся.


# Планируем путешествие
_______

### Функциональные требования
```
Посты
- пользователь может публиковать посты из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;

Подписки
- пользователь может подписаться на других путешественников, чтобы следить за их активностью;

Ленты постов
- пользователь может просматривать ленты других путешественников;
- для каждого пользователя система должна формировать ленту постов, основанную на подписках (в обратном хронологическом порядке времени постов);

Реакции
- пользователь может давать оценку постов других путешественников, на которых подписан;

Комментарии
- пользователь может оставлять комментарии под постами других путешественников, на которых подписан;

Поиск
- поиск популярных мест для путешествий
- просмотр постов с популярных мест;
```


### Нефункциональные требования

```
Аудитория сервиса  
    Количество пользователей:  
        - 10 000 000 DAU (через год с последующим ростом) 
        - 15 000 000 DAU (предположительно через 2 года с учетом роста)
    Поведение пользователей:
        Посты
            - пользователь в среднем публикует 10 постов в месяц
        Ленты постов
            - пользователь в среднем просматривает 30 постов в день
        Реакции постов
            - пользователь в среднем ставит оценку для 10 постов в день
        Комментарии
            - пользователь в среднем добавляет 5 комментариев в день
        Подписки 
            - пользователь в среднем создает 1 новую подписку в месяц
    География 
        - СНГ
Особенности приложения
    Надежность
        - В приоритете надежность системы (availability 99.9%)
    Удобство пользования
        - оптимизация под мобильные устройства и браузер
    Сезонность
        - Новогодние, майские праздники и летние отпуска (предположим что x1.5 это фактор увеличения активности пользователей)
    Хранение данных
        - все время
    Лимиты
        - пользователь может создать не более 1000 подписок
        - пользователь может иметь не более 500 000 подписчиков
        - не больше 10 фотографий на пост
        - 1 фотография не больше 1 MB
        - не более 500 символов на пост
        - не более 200 символов на комментарий 
    
    ...    
```

# Собираемся в путешествие

> Делаем расчет с поправкой на будущий рост (15 000 000 DAU). Фактор сезонности учтем при детальном проектировании системы

#### RPS
  
```
  Посты
    - write: 15 000 000 DAU * 10 постов в месяц / 30 дней / 24 ч / 60 м / 60 с = 150 * 10^6 / 30 / 10^5 = 50;
  Подписки
    - write: 15 000 000 DAU * 1 подписка в месяц / 30 дней / 24 ч / 60 м / 60 с = 150 * 10^5 / 30 / 10^5 = 5;
  Реакции
    - write: 15 000 000 DAU * 10 реакций в день / 24 ч / 60 м / 60 с = 150 * 10^6 / 10^5 = 1 500;
  Комментарии
    - write: 15 000 000 DAU * 5 комментариев в день / 24 ч / 60 м / 60 с = 15 * 5 * 10^6 / 10^5 = 750;
  Лента
    - read: 15 000 000 DAU * 30 постов в день / 24 ч / 60 м / 60 с = 15 * 30 * 10^6 / 10^5 = 4 500;
 ```

#### Драфт версия сущностей
```
    PostMsg  (~ 1.2 kB) 
    - id (8 B)
    - userId (8 B)
    - text    (500 B * 2)
    - imageIds  (10 * 8 B)
    - latitude  (8 B)
    - longitude  (8 B)
    - publishedAt (8 B)


    SubscribeMsg (24 B)
    - subscriptionId (8 B)
    - postAuthorId (8 B)
    - followerId (8 B)


    ReactionMsg (20 B)
    - postid (8 B)
    - followerId (8 B)
    - reaction [enum 1-5] (4 B)


    CommentMsg (416 B = ~ 420 B)
    - postId (8 B)
    - followerId (8 B)
    - comment (200 B * 2)
```

#### Throughput
```
    Посты
        - write (сообщения): 50 RPS * 1.2 kB = 60 kB/s
        - write (медиа): 50 RPS * 10 * 1MB image = 500 MB/s 
    Подписки
        - write: 5 RPS * 24 B = 120 B/s
    Реакции
        - write: 1 500 RPS * 20 B = 30 kB/s 
    Комментарии
        - write: 750 RPS *  420 B = 750 * 0.5 * 10^3 = 375 kB/s
    Лента
        если [RPS ленты / RPS постов = 4 500 / 50 = ~ 100] тогда) 
        - write (сообщения): 60 kB/s * 100 = 6 MB/s
        - write (медиа): 500 MB/s * 100 = 50 GB/s 
```

#### Расчет хранилища на 5 лет
```
    Посты
        текст: 60 kB/s * 5л * 365д * 24ч * 60м * 60c = ~ 3 * 10^2 * 4 * 10^2 * 10^5с = 12 * 10^9 = 12 TB
        медиа: 500 MB/s * 5л * 365 * 10^5 = 2.5 * 10^3 * 4 * 10^2 * 10^5  = 100 PB 
        c replication factor = 3
            текст: 36 TB
            медиа: 300 PB

    Подписки
       120 B/s * 5л * 4 * 10^2д * 10^5 = 24 * 10^9 B/s = 24 GB
       c replication factor = 3: 72 GB 

    Реакции
      30 kB/s * 2 * 10^3д * 10^5 = 60kB/s * 10^8 = 6 TB  
      c replication factor = 3: 18 TB 

    Комментарии
        375 kB/s * 2 * 10^3д * 10^5 = 40 * 10 * 2 * 10^8 = 80 TB
        c replication factor = 3: 240 TB 
```